runPacman();function runPacman(){const h=15,i=["blinky","pinky","inky","clyde"],j=2,k=100,l={table:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1],[1,3,1,0,0,1,2,1,0,0,0,1,2,1,1,2,1,0,0,0,1,2,1,0,0,1,3,1],[1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,2,1],[1,2,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,2,1],[1,2,2,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,2,2,1],[1,1,1,1,1,1,2,1,1,1,1,1,0,1,1,0,1,1,1,1,1,2,1,1,1,1,1,1],[0,0,0,0,0,1,2,1,1,1,1,1,0,1,1,0,1,1,1,1,1,2,1,0,0,0,0,0],[0,0,0,0,0,1,2,1,1,0,0,0,5,0,0,0,0,0,0,1,1,2,1,0,0,0,0,0],[0,0,0,0,0,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,0,0,0,0,0],[1,1,1,1,1,1,2,1,1,0,1,0,0,0,0,0,0,1,0,1,1,2,1,1,1,1,1,1],[0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0],[1,1,1,1,1,1,2,1,1,0,1,0,0,0,0,0,0,1,0,1,1,2,1,1,1,1,1,1],[0,0,0,0,0,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,0,0,0,0,0],[0,0,0,0,0,1,2,1,1,0,0,0,0,0,0,0,0,0,0,1,1,2,1,0,0,0,0,0],[0,0,0,0,0,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,0,0,0,0,0],[1,1,1,1,1,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1],[1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1],[1,3,2,2,1,1,2,2,2,2,2,2,2,4,0,2,2,2,2,2,2,2,1,1,2,2,3,1],[1,1,1,2,1,1,2,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,1,1],[1,1,1,2,1,1,2,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,1,1],[1,2,2,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,2,2,1],[1,2,1,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1],[1,2,1,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]};class m{constructor(b){this._id=b}get id(){return this._id}}class n extends m{constructor(d,a,b){super(b),this._position=d,this._direction=a,this._askedToChangeDirection=!1,this._askedDirection=a,this._previousPosition=d,this._initialPosition=d,this._initialDirection=a,this._isDead=!1}get position(){return this._position}get direction(){return this._direction}get askedToChangeDirection(){return this._askedToChangeDirection}get askedDirection(){return this._askedDirection}get previousPosition(){return this._previousPosition}get isDead(){return this._isDead}move(){this._previousPosition=this._position,this._position=this._position.nextPosition(this._direction)}respawnAtTheOpposite(b){this._position=b}askToChangeDirection(b){this._askedToChangeDirection=!0,this._askedDirection=b}changeDirection(){this._direction=this._askedDirection,this._askedToChangeDirection=!1}notifyIsBlocked(){}hasBeenEaten(){this._isDead=!0}respawn(){this._isDead=!1,this._position=this._initialPosition,this._direction=this._initialDirection}}class o extends m{constructor(b){super(b)}}class p extends o{constructor(c,a){super(c),this._isEnergizer=a}get isEnergizer(){return this._isEnergizer}}class q extends o{constructor(b){super(b)}}class r{constructor(c,a){this._row=c,this._column=a}get row(){return this._row}get column(){return this._column}nextPosition(b){return new r(this.row+b.deltaRow,this.column+b.deltaColumn)}}class s{constructor(c,a){this._nbRows=c,this._nbColumns=a,this._tiles=Array(c).fill().map(()=>Array(a))}contains(b){return 0<=b.row&&b.row<=this._nbRows-1&&0<=b.column&&b.column<=this._nbColumns-1}setTile(c,a){if(!this.contains(c))throw new Error("Invalid position.");this._tiles[c.row][c.column]=a}getTile(b){if(!this.contains(b))throw new Error("Invalid position.");return this._tiles[b.row][b.column]}hasTile(b){if(!this.contains(b))throw new Error("Invalid position.");return void 0!==this._tiles[b.row][b.column]}}class t{constructor(e){this._nbRows=e.table.length,this._nbColumns=e.table[0].length,this._layer_wall=new s(this._nbRows,this._nbColumns),this._layer_dot=new s(this._nbRows,this._nbColumns),this._nbDots=0;for(let a=0,b=1;a<e.table.length;a++)for(let c=0;c<e.table[a].length;c++,b++)switch(e.table[a][c]){case 1:this._layer_wall.setTile(new r(a,c),new q(`w_${b}`));break;case 2:this._layer_dot.setTile(new r(a,c),new p(`d_${b}`,!1)),this._nbDots++;break;case 3:this._layer_dot.setTile(new r(a,c),new p(`d_${b}`,!0)),this._nbDots++;break;case 4:this._pacmanRespawn=new r(a,c);break;case 5:this._ghostRespawn=new r(a,c);}}getWallLayerTile(b){if(this._layer_wall.contains(b))return this._layer_wall.getTile(b)}getDotLayerTile(b){if(this._layer_dot.contains(b))return this._layer_dot.getTile(b)}canWalkOn(b){return this._layer_wall.contains(b)&&!this._layer_wall.hasTile(b)}canPick(b){return this._layer_dot.contains(b)&&this._layer_dot.hasTile(b)}pick(c){if(this._layer_dot.hasTile(c)){let a=this._layer_dot.getTile(c);return this._layer_dot.setTile(c,void 0),this._nbDots--,a}throw new Error("There is no dot at the given position.")}isEmpty(){return 0===this._nbDots}get nbRows(){return this._nbRows}get nbColumns(){return this._nbColumns}get pacmanRespawn(){return this._pacmanRespawn}get ghostRespawn(){return this._ghostRespawn}}class u{constructor(b){this._maze=new t(b),this._pacman=new w(this._maze.pacmanRespawn,v.WEST),this._ghosts=i.map(b=>new x(this._maze.ghostRespawn,b)),this._score=0,this._highScore=localStorage.getItem("highScore")||0,this._removedDot,this._isPaused=!1}get maze(){return this._maze}get pacman(){return this._pacman}get ghosts(){return this._ghosts}get highScore(){return this._highScore}get score(){return this._score}get removedDot(){return this._removedDot}get isPaused(){return this._isPaused}markPause(){this._isPaused=!0}markPlay(){this._isPaused=!1}moveSprites(){let c=this.pacman.position.nextPosition(this.pacman.direction);this.pacman.askedToChangeDirection&&this.maze.canWalkOn(this.pacman.position.nextPosition(this.pacman.askedDirection))?(this.pacman.changeDirection(),this.pacman.move()):this.maze.canWalkOn(c)?this.pacman.move():0>c.column?(this.pacman.respawnAtTheOpposite(new r(this.pacman.position.row,this.maze.nbColumns)),this.pacman.move()):c.column>=this.maze.nbColumns&&(this.pacman.respawnAtTheOpposite(new r(this.pacman.position.row,-1)),this.pacman.move()),this.maze.canPick(this.pacman.position)&&(this._removedDot=this.maze.pick(this.pacman.position),this._removedDot.isEnergizer?(this._score+=k,this.pacman.makeSuper()):this._score+=10),this.ghosts.forEach(a=>{c=a.position.nextPosition(a.direction),a.askedToChangeDirection&&this.maze.canWalkOn(a.position.nextPosition(a.askedDirection))?(a.notifyIsBlocked(),a.move()):this.maze.canWalkOn(c)?a.move():0>c.column?(a.respawnAtTheOpposite(new r(a.position.row,this.maze.nbColumns)),a.move()):c.column>=this.maze.nbColumns?(a.respawnAtTheOpposite(new r(a.position.row,-1)),a.move()):a.notifyIsBlocked()}),this.pacman.isSuper&&this.ghosts.forEach(b=>{b.canEat(this.pacman)&&(this.pacman.hasEatenAGhost(),b.hasBeenEaten(),b.respawn(),this._score+=this.pacman.coinsFromGhost)});for(let c=0,a=!1;!a&&c<this.ghosts.length;c++)this.ghosts[c].canEat(this.pacman)&&(this.pacman.hasBeenEaten(),a=!0)}isGameOver(){return 0>this.pacman.nbLives}saveScore(){this._score>this._highScore&&(this._highScore=this._score,localStorage.setItem("highScore",this._highScore))}pacmanHasBeenEaten(){return this.pacman.isDead}respawn(){[this.pacman,...this.ghosts].forEach(b=>{b.respawn()})}lvlSucceed(){return this._maze.isEmpty()}nextLevel(){this._maze=new t(l),this.respawn()}}class v{constructor(c,a){this._deltaRow=c,this._deltaColumn=a}get deltaRow(){return this._deltaRow}get deltaColumn(){return this._deltaColumn}}v.NORTH=new v(-1,0),v.SOUTH=new v(1,0),v.WEST=new v(0,-1),v.EAST=new v(0,1);class w extends n{constructor(c,a){super(c,a,"007"),this._nbLives=2,this._isSuper=!1,this._powerGain=j}get nbLives(){return this._nbLives}get isSuper(){return this._isSuper}get coinsFromGhost(){return k*this._powerGain}hasBeenEaten(){this._nbLives--,this._isDead=!0}hasEatenAGhost(){this._powerGain++}makeSuper(){this._isSuper=!0,clearTimeout(this._powerTimeout),this._powerTimeout=setTimeout(()=>{this._isSuper=!1,this._powerGain=j},1e4)}}class x extends n{constructor(d,a){const b=()=>[v.NORTH,v.SOUTH,v.EAST,v.WEST].sort(()=>.5-Math.random())[0];super(d,b(),a),this._getRandomDirection=b,setInterval(()=>{this._choiceNewDirection()},4e3)}_choiceNewDirection(){this.askToChangeDirection(this._getRandomDirection()),this.changeDirection()}canEat(f){let a=JSON.stringify(this.position),b=JSON.stringify(f.position),c=JSON.stringify(this.previousPosition),d=JSON.stringify(f.previousPosition);return a===b||c===b&&a===d}notifyIsBlocked(){this._choiceNewDirection()}}class y{constructor(c,a){this._game=c,this._gameCtrl=a,this._nbRows=c.maze.nbRows,this._nbColumns=c.maze.nbColumns,this._updateMazeArea(),this._createMaze(),this.updateLives(),this.displayGameOver(),$("#pacman-container").append($("<button>",{text:"Start",id:"start",class:"jdb-button jdb-round-xl jdb-margin-8 jdb-black jdb-hover-blue-o jdb-border jdb-border-w2 jdb-ripple jdb-text-shadow-multiple-dark"}).one("click",b=>{this.startGame(),$(b.target).click(()=>{this._togglePause()}).html($("<span>",{"aria-hidden":!0,class:"fa jdb-margin-right fa-pause",style:"top:-3px; position:relative"})).append($("<span>").text(" Pause"))})),$(window).on("keydown",b=>{switch(b.key.toLowerCase()){case"p":this._togglePause();break;case"r":window.location.reload();}})}_togglePause(){let b=$("#pacman-container").find("#start").find("span");this._game.isPaused?(this._game.markPlay(),this._gameCtrl.play(),$(".mz-pacman").removeClass("not-started"),b.last().text("Pause"),b.first().removeClass("fa-play").addClass("fa-pause")):(this._game.markPause(),this._gameCtrl.pause(),$(".mz-pacman").addClass("not-started"),b.last().text("Play"),b.first().removeClass("fa-pause").addClass("fa-play"))}_updateMazeArea(){$("#maze-area").css({height:`${h*this._nbRows}px`,width:`${h*this._nbColumns}px`})}_createMaze(){const j=b=>$("<span>",{class:b.class,id:b.id}).css(({top:m,left:l}=b));let a,k,l,m,n=$("#maze-area"),f=1;for(a=0;a<this._nbRows;a++)for(k=0;k<this._nbColumns;k++,f++)m=`${h*a}px`,l=`${h*k}px`,this._game.maze.getWallLayerTile(new r(a,k))?n.append(j({class:"mz-wall",top:m,left:l})):this._game.maze.getDotLayerTile(new r(a,k))&&(this._game.maze.getDotLayerTile(new r(a,k)).isEnergizer?n.append(j({class:"mz-pac-dot energizer",id:`d_${f}`,top:m,left:l})):n.append(j({class:"mz-pac-dot",id:`d_${f}`,top:m,left:l})));n.append(j({class:"mz-pacman not-started",top:`${h*this._game.maze.pacmanRespawn.row}px`,left:`${h*this._game.maze.pacmanRespawn.column}px`})),i.forEach(a=>{n.append(j({class:`ghost ${a}`,top:`${h*this._game.maze.ghostRespawn.row}px`,left:`${h*this._game.maze.ghostRespawn.column}px`}))})}updateFrame(){$(".mz-pacman").css({top:`${h*this._game.pacman.position.row}px`,left:`${h*this._game.pacman.position.column}px`}).attr("data-dir",()=>{switch(this._game.pacman.direction){case v.NORTH:return"to-top";case v.EAST:return"to-right";case v.WEST:return"to-left";case v.SOUTH:return"to-bottom";}}),$.each(i,(c,a)=>{$(`.ghost.${a}`).css({top:`${h*this._game.ghosts[c].position.row}px`,left:`${h*this._game.ghosts[c].position.column}px`})}),this._game.removedDot&&($(`#${this._game.removedDot.id}`).remove(),$(`#current-score`).find("span").text(this._game.score),this._game.removedDot.isEnergizer&&this._game.pacman.isSuper&&$(`#current-score`).find("span").addClass("jdb-text-green").delay(1e3).queue(function(){$(this).removeClass("jdb-text-green").dequeue()}))}updateLives(){let c=$("#lives-area");c.empty();for(let a=0;a<this._game.pacman.nbLives;a++)c.append($("<span>"))}displayGameOver(){$("#high-score").text(this._game.highScore)}disablePacman(){$(".mz-pacman").addClass("not-started")}nextLevel(){$("#maze-area").empty(),this._updateMazeArea(),this._createMaze()}startGame(){this._gameCtrl.startHasBeenRequested()}}class z{constructor(c){$(window).on("keydown",a=>{switch(a.key){case"ArrowUp":a.preventDefault(),c.askToChangeDirection(v.NORTH);break;case"ArrowRight":a.preventDefault(),c.askToChangeDirection(v.EAST);break;case"ArrowDown":a.preventDefault(),c.askToChangeDirection(v.SOUTH);break;case"ArrowLeft":a.preventDefault(),c.askToChangeDirection(v.WEST);}}),$("#pacman-controls-btn #go-up").click(()=>{c.askToChangeDirection(v.NORTH)}),$("#pacman-controls-btn #go-right").click(()=>{c.askToChangeDirection(v.EAST)}),$("#pacman-controls-btn #go-down").click(()=>{c.askToChangeDirection(v.SOUTH)}),$("#pacman-controls-btn #go-left").click(()=>{c.askToChangeDirection(v.WEST)})}}class A{constructor(){this.game=new u(l),this.view=new y(this.game,this),this._pacmanCtrl=new B(this.game.pacman),this._pacmanView=new z(this._pacmanCtrl)}run(){this.view.updateLives(),this.view.displayGameOver(),this.play()}pause(){clearInterval(this._timer)}play(){this._timer=setInterval(()=>{this.game.moveSprites(),this.game.pacmanHasBeenEaten()&&(this.game.respawn(),this.view.updateLives()),this.game.lvlSucceed()&&(this.game.nextLevel(),this.view.nextLevel()),this.game.isGameOver()&&(console.log("GAME OVER !"),clearInterval(this._timer),this.game.saveScore(),this.view.displayGameOver(),this.view.disablePacman()),this.view.updateFrame()},300)}startHasBeenRequested(){this.run()}}class B{constructor(b){this.pacman=b}askToChangeDirection(b){this.pacman.askToChangeDirection(b)}}$(function(){new A})}